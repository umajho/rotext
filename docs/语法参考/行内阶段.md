# 行内阶段

行内阶段的语法围绕[[#行内元素|行内元素]]与[[#文本|文本]]展开，相邻的[[#行内元素|行内元素]]与<wbr />
[[#文本|文本]]会组成[[#行内序列|行内序列]]。

在[[#适用于行内元素的槽位|适用于行内元素的槽位]]之中，有部分槽位需要填充[[#行内序列|行内序列]]。借由这些槽<wbr />
位，块级元素之间能够形成层级结构。

## 行内阶段概念一览

### 换行

Rotext 采用硬换行，若不使用[[行内额外语法一览/行合并标记|行合并标记]]，会保留行与行之间的换行。

### 行内阶段对空白字符的处理

行内阶段源代码中每行开头连续的、未被转义（[[全局语法一览/逐字转义|逐字转义]]或<wbr />
[[行内额外语法一览/反斜杠转义|反斜杠转义]]）的空格（不能是其它空白字符）都会被无视。

例如：

```example
  第  一  行  <% 有空白 %>
  第  二  行  <% 有空白 %>
    <`  `>第  三  行  <% 有空白 %>
    \  第  四  行  <% 有空白 %>
    &#x20;  第  五  行  <% 有空白 %>
···
<p>第  一  行  <br>第  二  行  <br>  第  三  行  <br>  第  四  行  <br>  第  五  行  </p>
```

```example
    <`  `>第一段

    \  第二段

    &#x20; 第三段
···
<p>  第一段</p>
<p>  第二段</p>
<p>  第三段</p>
```

### 行内元素

**<ruby>行内<rt>Inline</rt></ruby>&#x200B;[[通用概念#元素|元素]]**&#x200B;对应于 HTML <wbr />
之中的行内元素。用于展现或修饰文档内容。

行内元素不应与通常意义上的 “行” 相混淆。通过硬[[#换行|换行]]，行内序列在实际呈<wbr />
现中可以断成多行。

[[行内元素一览/行内扩展|行内扩展]]、[[行内元素一览/行内嵌入包含相关/行内嵌入包含|行内嵌入包含]]与[[行内元素一览/行内嵌入包含相关/行内参数填充|行内参数填充]]是比较特殊的块级元素。所<wbr />
有行内元素中，只有这三种不保证渲染得到的最外层一定是一个单独的 HTML 元素。

<!--TODO: 将上述三者单独划分为 “伪行内元素”，与其他块级元素合称 “类行内元素” 之类的？-->

### 文本

在[[行内阶段]]中，**文本**是那些渲染结果不存在特殊功能（因而不被解析为<wbr />
[[#行内元素|行内元素]]）的内容。渲染得到的文本并不一定逐字对应于源代码中的文本，因<wbr />
为文本可以通过[[全局语法一览/逐字转义|逐字转义]]或[[行内额外语法一览/反斜杠转义|反斜杠转义]]产生。

### 行内序列

**行内序列**由一连串相邻的[[#行内元素|行内元素]]与[[#文本|文本]]组成。

### 适用于行内元素的槽位

根据情况，可以将**适用于行内元素的[[通用概念#槽位|槽位]]**（以下简称为 “行内元素槽位”）<wbr />
能够填充的内容分为以下几类：

- [[#行内序列|行内序列]]，
- [[#行内参数|行内参数]]，
- [[通用概念#逐字内容|逐字内容]]。

#### 行内元素槽位的分隔符

行内元素[[通用概念#槽位的分隔符|槽位的分隔符]]可以插在[[通用概念#直属|直属]]于它的[[#行内元素|行内元素]]闭合之后，此<wbr />
外，还可以截断[[通用概念#直属|直属]]于它的[[#文本|文本]]：

```example use-fixtures=两个刮开
[{两个刮开 | ['foo'] | [~bar~] ['baz']}]
···
<p><x-scratch-off><span slot="content"><strong>foo</strong></span></x-scratch-off> <x-scratch-off><span slot="content"><s>bar</s><strong>baz</strong></span></x-scratch-off></p>
```

```example-fixture name=两个刮开
[{#刮开|[{{1}}]}] [{#刮开|[{{2}}]}]
```

```example use-fixtures=两个刮开
[{两个刮开|吃葡萄|不吐葡萄皮。}]
···
<p><x-scratch-off><span slot="content">吃葡萄</span></x-scratch-off> <x-scratch-off><span slot="content">不吐葡萄皮。</span></x-scratch-off></p>
```

```example
<% “|” 适用于 “注音”，而非 “刮开”。 %>
[{#刮开| [{#注音| 某某 | mǒu mǒu}]}]
···
<p><x-scratch-off><span slot="content"><ruby>某某<rt>mǒu mǒu</rt></ruby></span></x-scratch-off></p>
```

若不满足上述条件，潜在分隔符标记保持原样（在预览期间呈现警告）：

```example
['加粗里边|分隔符没用。']
···
<p><strong>加粗里边<x-preview-warn type="potential-inline-level-separator">|</x-preview-warn>分隔符没用。</strong></p>
```

```example
吃葡萄|不吐葡萄皮。
···
<p>吃葡萄<x-preview-warn type="potential-inline-level-separator">|</x-preview-warn>不吐葡萄皮。</p>
```

#### 行内元素槽位通用的终止界限

行内元素槽位存在多种终止界限：

- 无论是何种行内元素槽位，到达其所属[[块级阶段#块级元素|块级元素]]的终止界限时肯定都要终止：

  ```example
  第一段[`行内代码没闭合，

  但因为第一个段落终止了，那处行内代码也终止了。
  ···
  <p>第一段<code>行内代码没闭合，</code></p>

  <p>但因为第一个段落终止了，那处行内代码也终止了。</p>
  ```

- 对于有闭合部分或分隔符的行内元素的槽位，到达其所属元素闭合部分或分隔符<wbr />
  时要终止；

- 对于除了[[行内元素一览/行内代码|行内代码]]之外的行内元素槽位，若其父级元素为行内元素，到达后者<wbr />
  的终 止界限时要终止：

  ```example
  ['没有闭合的[~删除线']只延续到包裹它的加粗结束前。
  ···
  <p><strong>没有闭合的<s>删除线</s></strong>只延续到包裹它的加粗结束前。</p>
  ```

  - 需要特别注意，对于填充[[通用概念#逐字内容|逐字内容]]的行内元素槽位，其所属元素外部元素<wbr />
    的闭合部分于该逐字内容中无效：

    ```example
    ['加粗的闭合部分是[`']`]']。
    ···
    <p><strong>加粗的闭合部分是<code>']</code></strong>。</p>
    ```

- 此外，许多行内元素有独自的、与父级无关的规则用于确定其槽位的终止界限，<wbr />
  这些规则会在对应元素的章节中说明。

#### 行内参数

**行内参数**是用于为[[行内元素一览/行内嵌入包含相关/行内嵌入包含|行内嵌入包含]]或[[行内元素一览/行内扩展|行内扩展]]提供参数的槽位。

- 槽位：
  - 可选：任意数量的空白、剪除首尾空白后作为参数名称的单行[[通用概念#逐字内容|逐字内容]]、<wbr />
    任意数量的空白、`=` 与任意数量的空白。
    - 之后必须：填充[[#行内序列|行内序列]]。
